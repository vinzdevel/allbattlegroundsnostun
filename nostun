HumanModCons = HumanModCons or {} -- Đảm bảo HumanModCons tồn tại
G = G or {} -- Đảm bảo G tồn tại
G.speed = G.speed or 25 -- Mặc định tốc độ là 25 nếu chưa được đặt
G.jpower = G.jpower or 50 -- Mặc định JumpPower là 50 nếu chưa được đặt

local speaker = game.Players.LocalPlayer
local function UpdateCharacter(nChar)
    local Char = nChar or speaker.Character
    local Human = Char and Char:FindFirstChildWhichIsA("Humanoid")

    local function WalkSpeedChange()
        if Char and Human then
            Human.WalkSpeed = G.speed
        end
    end

    local function JumpPowerChange()
        if Char and Human then
            if Human.UseJumpPower then
                Human.JumpPower = G.jpower
            else
                Human.JumpHeight = G.jpower
            end
        end
    end

    WalkSpeedChange()
    JumpPowerChange()

    -- Ngắt kết nối cũ nếu có và tạo kết nối mới
    if Human then
        if HumanModCons.wsLoop then
            HumanModCons.wsLoop:Disconnect()
        end
        HumanModCons.wsLoop = Human:GetPropertyChangedSignal("WalkSpeed"):Connect(WalkSpeedChange)

        if HumanModCons.jpLoop then
            HumanModCons.jpLoop:Disconnect()
        end
        HumanModCons.jpLoop = Human:GetPropertyChangedSignal("JumpPower"):Connect(JumpPowerChange)
    end
end

UpdateCharacter(speaker.Character)

-- Đảm bảo khi nhân vật thay đổi, các thuộc tính vẫn được giữ nguyên
if HumanModCons.charAdded then
    HumanModCons.charAdded:Disconnect()
end
HumanModCons.charAdded = speaker.CharacterAdded:Connect(UpdateCharacter)
